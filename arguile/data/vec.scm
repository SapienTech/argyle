(module (arguile data vec)
  #:export (vec vec? vec-fn vec-fn!))
(use (arguile base)
     (arguile data))

;;; TODO: add optional fill
(data vec (v)
      #:init (%make-vec v)
      #:app (let v (vec-v self)
              (fn-case
               (() v)
               ((k) (vector-ref v k))
               ((k obj) (vector-set! v k obj)))))

(defp make-vec (len . fill)
  (%make-vec (if (nil? fill) (make-vector len)
                 (make-vector len (car fill)))))
(defp vec: (v k) (v k))
(defp vec! (v k obj) (v k obj))
(defp vec->lst (v) (vector->list (v)))
(defp lst->vec (lst) (%make-vec (list->vector lst)))
(defp vec-cpy (v) (%make-vec (vector-copy (v))))
(defp vec-fill! (v fill) (vector-fill! (v) fill))
(defp vec<-! (v1 s1 e1 v2 s2) (vector-move-left! (v1) s1 e1 (v2) s2))
(defp vec->! (v1 s1 e1 v2 s2) (vector-move-right! (v1) s1 e1 (v2) s2))
